{"version":3,"file":"RangesMarkerForm.js","sourceRoot":"","sources":["../../../../src/components/Configurator/RangesMarkerForm/RangesMarkerForm.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { FC, useCallback, useEffect, useState } from 'react';\nimport { Grid, TextFieldProps } from '@mui/material';\nimport {\n  getDefaultInteactiveSimpleListItem,\n  InteactiveSimpleList,\n  SimpleCheckbox,\n  SimpleTextField,\n  Vertical,\n} from 'mui';\nimport {\n  DynamicKeyValueList,\n  DynamicKeyValueListItem,\n  DynamicKeyValueListProps,\n} from '../KeywordForm/DynamicKeyValueList';\nimport { SimpleFormControlChange } from 'common-types';\nimport { uniqueId, reduce, noop, map, values } from 'lodash/fp';\nimport { RangesMarkerOptions } from 'mark.js';\nimport { someAreTruthy } from '../../../utils';\n\nconst reduceValuesToString = reduce<TextFieldProps, string[]>((acc, item) => {\n  if (item.value) {\n    return [...acc, String(item.value)];\n  }\n  return [...acc];\n}, []);\n\nconst getRefinedConfig = (\n  rawConfig: RangesMarkerRawConfig,\n  defaultConfig: RangesMarkerOptions\n): RangesMarkerOptions => {\n  const excludeValue = reduceValuesToString(rawConfig.exclude);\n\n  return {\n    className:\n      defaultConfig.className === rawConfig.className\n        ? undefined\n        : rawConfig.className,\n\n    debug:\n      defaultConfig.debug === rawConfig.debug ? undefined : rawConfig.debug,\n\n    element:\n      defaultConfig.element === rawConfig.element\n        ? undefined\n        : rawConfig.element,\n\n    exclude:\n      excludeValue.length === defaultConfig.exclude?.length\n        ? undefined\n        : excludeValue,\n\n    iframes:\n      defaultConfig.iframes === rawConfig.iframes\n        ? undefined\n        : rawConfig.iframes,\n\n    iframesTimeout:\n      defaultConfig.iframesTimeout === rawConfig.iframesTimeout\n        ? undefined\n        : rawConfig.iframesTimeout,\n  };\n};\n\nexport type RangesMarkerRawConfig = {\n  className: string;\n  debug: boolean;\n  element: string;\n  exclude: TextFieldProps[];\n  iframes: boolean;\n  iframesTimeout: number;\n};\n\nconst defaultConfig: RangesMarkerOptions = {\n  className: '',\n  debug: false,\n  element: 'mark',\n  exclude: [],\n  iframes: false,\n  iframesTimeout: 5000,\n};\n\ntype RangeItem = {\n  start: number;\n  length: number;\n};\n\nexport type OnChangeRanges = (ranges: RangeItem[]) => void;\n\nexport type RangesMarkerFormProps = {\n  ranges?: RangeItem[];\n  onChangeOptions?: (config: RangesMarkerOptions | undefined) => void;\n  onChangeRanges?: OnChangeRanges;\n};\n\nexport const RangesMarkerForm: FC<RangesMarkerFormProps> = ({\n  ranges = [{ length: 4, start: 7 }],\n  onChangeOptions = noop,\n  onChangeRanges = noop,\n}) => {\n  const [config, setConfig] = useState<RangesMarkerRawConfig>({\n    ...defaultConfig,\n    className: '',\n    debug: false,\n    element: 'mark',\n    exclude: [getDefaultInteactiveSimpleListItem()],\n    iframes: false,\n    iframesTimeout: 5000,\n  });\n  const [rawRanges, setRawRanges] = useState<DynamicKeyValueListItem[]>(\n    map<RangeItem, DynamicKeyValueListItem>((range) => ({\n      field1: {\n        label: 'start',\n        size: 'small',\n        type: 'number',\n        value: range.start,\n      },\n      field2: {\n        label: 'length',\n        size: 'small',\n        type: 'number',\n        value: range.length,\n      },\n      id: uniqueId('range'),\n    }))(ranges)\n  );\n\n  const handleChangeConfig = useCallback<SimpleFormControlChange<any>>(\n    (name, value) => {\n      setConfig((prevConfig) => ({\n        ...prevConfig,\n        [name]: value,\n      }));\n    },\n    []\n  );\n\n  const handleChangeRange = useCallback<\n    NonNullable<DynamicKeyValueListProps['onChange']>\n  >(\n    (name, value) => {\n      setRawRanges(value);\n      const ranges: RangeItem[] = map<DynamicKeyValueListItem, RangeItem>(\n        (item) => {\n          return {\n            length: Number(item.field2.value),\n            start: Number(item.field1.value),\n          };\n        }\n      )(value);\n      onChangeRanges(ranges);\n    },\n    [onChangeRanges]\n  );\n\n  useEffect(() => {\n    const refinedConfig = getRefinedConfig(config, defaultConfig);\n    const refinedConfigValues = values(refinedConfig);\n    const someHaveValue = someAreTruthy(refinedConfigValues);\n    onChangeOptions(someHaveValue ? refinedConfig : undefined);\n  }, [config, onChangeOptions]);\n\n  return (\n    <Grid container spacing={2}>\n      {/* COLUMN 1 */}\n      <Grid item xs={12}>\n        <DynamicKeyValueList\n          title=\"Ranges\"\n          name=\"ranges\"\n          value={rawRanges}\n          onChange={handleChangeRange}\n        />\n      </Grid>\n      <Grid item xs={6} sm={6}>\n        <Vertical gap={2}>\n          <SimpleTextField\n            fullWidth\n            name=\"element\"\n            label=\"Element\"\n            type=\"text\"\n            size=\"small\"\n            value={config.element}\n            onChange={handleChangeConfig}\n          />\n          <InteactiveSimpleList\n            label=\"exclude\"\n            title=\"Exclude\"\n            name=\"exclude\"\n            value={config.exclude}\n            onChange={handleChangeConfig}\n          />\n\n          <SimpleTextField\n            fullWidth\n            name=\"iframesTimeout\"\n            label=\"IFrames Timeout\"\n            type=\"number\"\n            value={config.iframesTimeout}\n            size=\"small\"\n            onChange={handleChangeConfig}\n          />\n        </Vertical>\n      </Grid>\n      <Grid item xs={6} sm={6}>\n        <Vertical gap={2}>\n          <SimpleTextField\n            fullWidth\n            name=\"className\"\n            label=\"Class Name\"\n            type=\"text\"\n            size=\"small\"\n            value={config.className}\n            onChange={handleChangeConfig}\n          />\n          <Vertical>\n            <SimpleCheckbox\n              label={'Iframes'}\n              name=\"iframes\"\n              checked={config.iframes}\n              onChange={handleChangeConfig}\n            />\n            <SimpleCheckbox\n              label={'Debug'}\n              name=\"debug\"\n              checked={config.debug}\n              onChange={handleChangeConfig}\n            />\n          </Vertical>\n        </Vertical>\n      </Grid>\n    </Grid>\n  );\n};\n"]}